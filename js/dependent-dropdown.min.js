/*!
 * @copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @version 1.3.0
 *
 * A multi level dependent dropdown JQuery plugin. The plugin
 * allows nested and combined dependencies.
 * 
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){var t=function(t,a){return"undefined"==typeof t||null===t||void 0===t||t==[]||""===t||a&&""===e.trim(t)},a=function(t,a,n,i){var l=a==i&&null!==i?{value:a,text:n,selected:"selected"}:{value:a,text:n};e("<option/>",l).appendTo(t)},n=function(t,n,i){var l=e("<select>");return n!==!1&&a(l,"",n,i),e.each(t,function(t,n){if(n.id)a(l,n.id,n.name,i);else{var d=e("<optgroup>",{label:t});e.each(n,function(e,t){a(d,t.id,t.name,i)}),d.appendTo(l)}}),l.html()},l=function(i,l,d,o,r,p,s,g,u,c,f,h){var m=i,v=l,y=d,$=o,x=r,b=0,C=u,T=c,M=f,j={depdrop_parents:$};if(!t(h)){for(var z={},D=0;D<h.length;D++)z[D]=e("#"+h[D]).val();j={depdrop_parents:$,depdrop_params:z}}var _={url:v,type:"post",data:j,dataType:"json",success:function(i){var l=T===!1?t(i.selected)?null:i.selected:T;null==i||0===i.length?a(m,"",C,""):(m.html(n(i.output,x,l)),m.find("optgroup").length>0&&m.find('option[value=""]').attr("disabled","disabled"),0!==i.output.length&&(m.val(l),m.removeAttr("disabled"))),b=m.find("option").length,m.find('option[value=""]').length>0&&b--,m.trigger("depdrop.change",[y,e("#"+y).val(),b,T])}};return _.beforeSend=function(){m.trigger("depdrop.beforeChange",[y,e("#"+y).val(),T]),m.attr("disabled","disabled"),m.html(""),p&&(m.addClass(s),m.html('<option id="">'+g+"</option>"))},_.error=function(){m.trigger("depdrop.error",[y,e("#"+y).val(),T])},_.complete=function(){m.trigger("depdrop.afterChange",[y,e("#"+y).val(),T]),M(),p&&m.removeClass(s)},_},d=function(t,a,n){var o,r=(e("#"+a[t]),{}),p=e("#"+a[t+1]),s=a.length;for(i=0;t>=i;i++)o=e("#"+a[i]),r[i]=o.val();var g=n[t+1];s-1>t&&e.ajax(l(p,p.data("url"),p.attr("id"),r,p.data("placeholder"),p.data("loading"),p.data("loadingClass"),p.data("loadingText"),p.data("emptyMsg"),g,function(){d(t+1,a,n)},p.data("params")))},o=function(t,a){this.$element=e(t),this.url=a.url,this.depends=a.depends,this.loading=a.loading,this.loadingClass=a.loadingClass,this.loadingText=a.loadingText,this.placeholder=a.placeholder,this.emptyMsg=a.emptyMsg,this.initialize=a.initialize,this.params=a.params,this.initData(),this.init()};o.prototype={constructor:o,initData:function(){var e=this;e.$element.data("url",e.url),e.$element.data("depends",e.depends),e.$element.data("placeholder",e.placeholder),e.$element.data("loading",e.loading),e.$element.data("loadingClass",e.loadingClass),e.$element.data("loadingText",e.loadingText),e.$element.data("emptyMsg",e.emptyMsg),e.$element.data("initialize",e.initialize),e.$element.data("params",e.params)},init:function(){var t,a=this,n=a.depends,i=n.length,l=(a.$element.val(),{}),o=a.$element.find("option").length;(0==o||a.$element.find('option[value=""]').length==o)&&a.$element.attr("disabled","disabled");for(var r=0;i>r;r++)t=e("#"+n[r]),t.on("change",function(){a.setDependency(t,n,i,!1)});if(a.initialize===!0){for(var p=0;i>p;p++)p>0&&(l[p]=e("#"+n[p]).val());n[i]=a.$element.attr("id"),l[i]=a.$element.val();{n.join()}e(document).ready(function(){d(0,n,l)})}a.$element.trigger("depdrop.init")},setDependency:function(t,a,n,i){for(var d=this,o={},r=i,p=function(){d.$element.trigger("change")},s=0;n>s;s++){var g=e("#"+a[s]);o[s]=g.val()}e.ajax(l(d.$element,d.url,t.attr("id"),o,d.placeholder,d.loading,d.loadingClass,d.loadingText,d.emptyMsg,r,p,d.params))}},e.fn.depdrop=function(t){var a=Array.apply(null,arguments);return a.shift(),this.each(function(){var n=e(this),i=n.data("depdrop"),l="object"==typeof t&&t;i||n.data("depdrop",i=new o(this,e.extend({},e.fn.depdrop.defaults,l,e(this).data()))),"string"==typeof t&&i[t].apply(i,a)})},e.fn.depdrop.defaults={url:"",loading:!0,loadingClass:"kv-loading",loadingText:"Loading ...",placeholder:"Select ...",emptyMsg:"No data found",initialize:!1,params:{}},e(function(){e("select.depdrop").depdrop()})}(jQuery);